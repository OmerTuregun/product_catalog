<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Giriş / Kayıt</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <style>
    body { min-height: 100vh; display:flex; align-items:center; background:#f8f9fa; }
    .auth-card { max-width: 420px; width:100%; }
  </style>
</head>
<body>
  <div class="container d-flex justify-content-center">
    <div class="card shadow auth-card">
      <div class="card-body">
        <h4 class="mb-3 text-center">Product Catalog</h4>

        <!-- Sekmeler -->
        <ul class="nav nav-tabs mb-3" id="authTabs" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="login-tab" data-bs-toggle="tab" data-bs-target="#login-pane" type="button" role="tab">Giriş</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="register-tab" data-bs-toggle="tab" data-bs-target="#register-pane" type="button" role="tab">Kayıt Ol</button>
          </li>
        </ul>

        <div class="tab-content">
          <!-- Giriş -->
          <div class="tab-pane fade" id="login-pane" role="tabpanel">
            <div class="mb-3">
              <label class="form-label">Kullanıcı Adı</label>
              <input id="loginUser" class="form-control" autocomplete="username">
            </div>
            <div class="mb-3">
              <label class="form-label">Şifre</label>
              <input id="loginPass" type="password" class="form-control" autocomplete="current-password">
            </div>
            <button id="loginSubmit" class="btn btn-primary w-100">Giriş Yap</button>
          </div>

          <!-- Kayıt -->
          <div class="tab-pane fade" id="register-pane" role="tabpanel">
            <div class="mb-3">
              <label class="form-label">Kullanıcı Adı</label>
              <input id="regUser" class="form-control" autocomplete="username">
            </div>
            <div class="mb-3">
              <label class="form-label">Şifre</label>
              <input id="regPass" type="password" class="form-control" autocomplete="new-password">
            </div>
            <button id="registerSubmit" class="btn btn-success w-100">Kayıt Ol</button>
            <p class="text-muted small mt-2">Kayıttan sonra giriş yaparak ana sayfaya erişebilirsiniz.</p>
          </div>
        </div>

        <div id="msg" class="alert alert-info mt-3 d-none"></div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    function showMsg(text, cls='info') {
      const el = document.getElementById('msg');
      el.className = 'alert alert-' + cls;
      el.textContent = text;
      el.classList.remove('d-none');
    }

    async function api(path, opts={}) {
      const res = await fetch(path, {headers:{'Content-Type':'application/json'}, credentials:'include', ...opts});
      let body = {};
      try { body = await res.json(); } catch(e) {}
      if (!res.ok) throw new Error(body.error || 'Hata');
      return body;
    }

    // Giriş
    document.getElementById('loginSubmit').onclick = async ()=>{
      try {
        const username = document.getElementById('loginUser').value.trim();
        const password = document.getElementById('loginPass').value;
        await api('/api/auth/login', {method:'POST', body:JSON.stringify({username,password})});
        // Başarılı → ana sayfaya
        window.location.href = '/';
      } catch(e) { showMsg(e.message, 'danger'); }
    };

    // Kayıt
    document.getElementById('registerSubmit').onclick = async ()=>{
      try {
        const username = document.getElementById('regUser').value.trim();
        const password = document.getElementById('regPass').value;
        await api('/api/auth/register', {method:'POST', body:JSON.stringify({username,password})});
        showMsg('Kayıt başarılı. Lütfen giriş yapın.', 'success');
        // Kayıttan sonra login sekmesine geç
        const loginTab = document.querySelector('#login-tab');
        new bootstrap.Tab(loginTab).show();
      } catch(e) { showMsg(e.message, 'danger'); }
    };

    // Hangi sekme açılsın? (view paramına göre)
    (function initTab(){
      // backend bu template’e view değişkeni yolluyor
      const defaultView = "{{ view|default('login') }}";
      const tabId = defaultView === 'register' ? '#register-tab' : '#login-tab';
      const tabBtn = document.querySelector(tabId);
      if (tabBtn) new bootstrap.Tab(tabBtn).show();
    })();
  </script>
</body>
</html>
